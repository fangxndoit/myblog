---
title: 双向数据绑定
date: 2022-08-20 21:45:35
tags:
---

#### 双向绑定有三个重要部分构成

- 数据层（Model）：应用的数据业务逻辑
- 视图层（View）：应用的展示效果，各类UI组件
- 业务逻辑层（ViewModel）：负责将数据与视图关联起来

MVVM

#### ViewModel

它的主要职责就是：

- 数据变化后更新视图
- 视图变化后更新数据

它的两个主要部分

- 监听器（Observer）：对所有数据的属性进行监听
- 解析器（Compiler）：对每个元素节点的指令进行扫描和解析，根据指令模版替换数据，以及绑定相应的更新函数

#### Vue中双向绑定流程

1. `new Vue()`首先执行初始化，对`data`执行响应式处理，这个过程发生在`Observe`中
2. 同时对模版执行编译，找到其中动态绑定的数据，从`data`中获取并初始化视图，这个过程发生在`Compile`中
3. 同时定义一个更新函数和`Watcher`，将来对应数据变化时`Watcher`会调用函数
4. 由于`data`的某个`key`在一个视图中可能出现多次，所以每个`key`都需要一个管家`Dep`来管理多个`Watcher`
5. 将来`data`中数据一旦发生变化，会首先找到对应的`Dep`，通知所有的`Watcher`执行更新函数

流程图

![vue双向绑定流程图](https://static.vue-js.com/e5369850-3ac9-11eb-85f6-6fac77c0c9b3.png)