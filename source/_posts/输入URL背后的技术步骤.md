---
title: 输入URL背后的技术步骤
date: 2022-07-05 13:27:13
tags:
---

### 系统层

#### 1.发起http请求，解析域名

#### 2.DNS

1. Chrome搜索自身DNS缓存。chrome输入`chrome://net-internals/#dns`可查到
2. 搜索操作系统自身DNS缓存
3. 读取本地HOST文件
4. 以上都查询不到时，浏览器发送一个DNS的系统调用，DNS请求到达宽带运营商服务器
5. 宽带运营商服务器查询自身缓存
6. 没查询时，发起一个迭代（顶级域--次级域--...）的DNS解析请求，直到获取到域名对应的IP地址

#### 3.拿到域名对应的IP并缓存

1. 宽带运营商服务器缓存DNS
2. 结果返回操作系统并缓存DNS
3. 结果返回浏览器并缓存DNS

#### 4.得到目标IP，发起HTTP三次握手，建立起TCP/IP连接

1. 客户端发送一个带有SYN标志的数据包给服务端
2. 服务端回传一个带有SYN/ACK标志的数据包
3. 客户端在回传一个带有ACK标志的数据包给服务端

#### 5.连接成功后，浏览器向服务器发起标准HTTP请求

1. 构建Http请求报文
   - 请求行
     - 格式：Method Request-URL HTTP-Version CRLF，如：GET index.html HTTP/1.1
     - Method可选项：GET、POST、PUT、DELETE、OPTIONS、HEAD
   - 请求报头
     - 允许客户端向服务器传递请求的附加信息
     - 常见请求报头：Accept、Accept-Charset、Accept-Encoding、Connection、Cookie
   - 请求正文
     - 当使用POST，PUT等方法时，通常需要客户端向服务器传递数据
2. 通过TCP协议，发送到服务端指定端口（Http协议默认80端口、Https协议默认443端口）

#### 6.服务器收到请求后，经后端处理返回结果

- 状态码
  - 1xx：指示信息
  - 2xx：成功
  - 3xx：重定向
  - 4xx：客户端错误
  - 5xx：服务端报错

#### 7.返回Html页面等资源，html包含css/js等资源，重复以上http请求

### 渲染层

- 首先解析收到的文档，根据文档构建一颗`DOM`树
- 然后解析`CSS`，生成`CSSOM`规则树
- 根据`DOM`树和`CSSOM`规则树构建渲染树，渲染树的节点被称为渲染对象，渲染对象是一个包含颜色和大小等属性的矩形，渲染树和`DOM`元素相对应
- 当渲染对象被创建的时候，浏览器根据渲染树来进行布局，自动重排
- 布局阶段结束后是绘制阶段，遍历渲染树并调用渲染对象的`paint`方法将内容显示在屏幕上，绘制使用`UI`基础组建

![dom](https://user-images.githubusercontent.com/6310131/55704761-927a2b00-5a0f-11e9-83c5-28bd475bdcc1.png)

html内容从上到下解析，浏览器遇到body标签开始显示内容。CSS不会阻塞DOM的解析，JS会阻止DOM解析

当文档加载过程遇到JS文件，HTML文档会挂起渲染过程，不仅要等到文档中的JS文件加载完毕还要等到解析执行完毕，才会继续HTML渲染过程

现在浏览器都使用了预加载器，在JS挂起DOM解析时，会继续解析后面的的html，寻找需要下载的资源。预加载下载这些资源，以减少JS阻塞带来的内容